<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebLLM Test</title>
</head>

<body>
    <h1>WebLLM Test</h1>
    <div id="status">Test başlatılıyor...</div>
    <div id="log"></div>

    <script type="module">
        async function testWebLLM() {
            const statusDiv = document.getElementById('status');
            const logDiv = document.getElementById('log');

            function log(message) {
                console.log(message);
                logDiv.innerHTML += '<div>' + message + '</div>';
            }

            try {
                log('🚀 WebLLM test başlatılıyor...');

                // Browser desteği kontrol et
                log('🔍 Browser desteği kontrol ediliyor...');
                log('WebAssembly: ' + (typeof WebAssembly !== 'undefined' ? '✅' : '❌'));
                log('SharedArrayBuffer: ' + (typeof SharedArrayBuffer !== 'undefined' ? '✅' : '❌'));
                log('crossOriginIsolated: ' + (window.crossOriginIsolated ? '✅' : '❌'));

                // WebLLM import et
                log('📦 WebLLM import ediliyor...');
                const { CreateMLCEngine } = await import('@mlc-ai/web-llm');
                log('✅ WebLLM başarıyla import edildi');

                // Model yükleme dene
                log('⏳ Model yükleme test ediliyor...');
                statusDiv.textContent = 'Model yükleniyor...';

                const engine = await CreateMLCEngine('Llama-3.2-1B-Instruct-q4f16_1-MLC', {
                    initProgressCallback: (report) => {
                        const progress = report.progress ? `${Math.round(report.progress * 100)}%` : '';
                        log(`📥 [${progress}]: ${report.text}`);
                        statusDiv.textContent = `Model yükleniyor... ${progress}`;
                    }
                });

                log('✅ Model başarıyla yüklendi!');
                statusDiv.textContent = 'Model hazır!';

            } catch (error) {
                log('❌ Hata: ' + error.message);
                statusDiv.textContent = 'Hata: ' + error.message;
                console.error('Detaylı hata:', error);
            }
        }

        testWebLLM();
    </script>
</body>

</html>